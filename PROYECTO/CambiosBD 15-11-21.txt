alter table "SAFE"."TBL_SERVICIOS" rename column "ART_INDICE" to "SER_INDICE";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_TIPO" to "SER_TIPO";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_DESC_BREVE" to "SER_DESC_BREVE";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_NOMBRE" to "SER_NOMBRE";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_IMPUESTOS" to "SER_IMPUESTOS";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_ESTADO" to "SER_ESTADO";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_CODIGO" to "SER_CODIGO";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_TIPO_CODIGO" to "SER_TIPO_CODIGO";
alter table "SAFE"."TBL_SERVICIOS" rename column "ART_VENTA_IVI" to "SER_VENTA_IVI";

/

create or replace PACKAGE BODY PCKSERVICIO AS
  PROCEDURE paInsertar(tipo        VARCHAR2,
                       codigo      VARCHAR2,
                       desBreve    VARCHAR2,
                       nombre      VARCHAR2,
                       impuestos   NUMBER,
                       indice      NUMBER,
                       tipo_codigo VARCHAR2,
                       venta_IVI   VARCHAR2,
                       pNo_cia     VARCHAR2,
                       pCod_cabys  VARCHAR2,
                       linea       OUT NUMBER) IS
    vCodigo VARCHAR2(100);
  
    existe boolean;
    dummy  varchar2(1);
  
    error exception;
    msg_error varchar2(1000);
  
    vCostoVenta         number;
    vMontoImpuestoVenta number;
    vMontoUtilidad      number;
    vSubTotalVenta      number;
    vPrecioVenta        number;
  
  BEGIN
    IF (indice > 0) THEN
      UPDATE tbl_servicios
         SET SER_DESC_BREVE  = desBreve,
             SER_Nombre      = desBreve,
             SER_impuestos   = impuestos,
             SER_codigo      = codigo,
             SER_tipo_codigo = tipo_codigo,
             SER_VENTA_IVI   = venta_IVI,
             cod_cabys       = pCod_cabys
       WHERE no_Cia = pNo_cia
         and SER_TIPO = tipo
         AND SER_ESTADO = 1
         AND SER_INDICE = indice;
      linea := indice;
    ELSE
      SELECT SSERVICIO.nextval INTO linea FROM dual;
    
      IF tipo_codigo = 'IN' THEN
        vCodigo := linea;
      ELSE
        vCodigo := codigo;
      END IF;
    
      INSERT INTO tbl_servicios
      VALUES
        (linea,
         tipo,
         desBreve,
         desBreve,
         impuestos,
         1,
         vCodigo,
         tipo_codigo,
         pNo_cia,
         venta_IVI,
         pCod_cabys);
    
    END IF;
  
    COMMIT;
  EXCEPTION
    WHEN timeout_on_resource THEN
      raise_application_error(-20100,
                              'Ha excedido el tiempo de espera maximo al insertar el servicio, vuelva a intentarlo');
    WHEN dup_val_on_index THEN
      raise_application_error(-20100, 'Servicio existente');
    WHEN OTHERS THEN
      raise_application_error(-20100,
                              'Error desconocido al insertar el servicio ' ||
                              sqlerrm);
  END paInsertar;
  ----------------------------------------------------------------------------------

  PROCEDURE paEliminar(tipo    VARCHAR2,
                       codigo  VARCHAR2,
                       indice  NUMBER,
                       pNo_cia VARCHAR2) IS
  BEGIN
  
    UPDATE tbl_servicios
       SET SER_ESTADO = 0
     WHERE no_Cia = pNo_cia
       and SER_TIPO = tipo
       AND SER_INDICE = indice;
  
    COMMIT;
  EXCEPTION
    WHEN timeout_on_resource THEN
      raise_application_error(-20100,
                              'Ha excedido el tiempo de espera maximo al borrar el servicio, por favor intente de nuevo');
    WHEN OTHERS THEN
      raise_application_error(-20100,
                              'Error desconocido al eliminar el servicio ' ||
                              sqlerrm);
  END paEliminar;

END;

/

create or replace NONEDITIONABLE TRIGGER TR_SERVICIOS_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_SERVICIOS
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA)
    VALUES
      ('SAFE',
       'TBL_SERVICIOS',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :old.NO_CIA || ' --> ' || 'SER_INDICE = ' || :old.SER_INDICE || ' --> ' || '<eol>',
       'SER_TIPO = ' || :old.SER_TIPO || ' --> ' || 
       'SER_DESC_BREVE = ' || :old.SER_DESC_BREVE || ' --> ' || 
       'SER_NOMBRE = ' || :old.SER_NOMBRE || ' --> ' || 
       'SER_IMPUESTOS = ' || :old.SER_IMPUESTOS || ' --> ' ||
       'SER_ESTADO = ' || :old.SER_ESTADO || ' --> ' || 
       'SER_CODIGO = ' || :old.SER_CODIGO || ' --> ' || 
       'SER_TIPO_CODIGO = ' || :old.SER_TIPO_CODIGO || ' --> ' || 
       'SER_VENTA_IVI = ' || :old.SER_VENTA_IVI || ' --> ' ||
       '<eol>',
       :old.NO_CIA);
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA)
    VALUES
      ('SAFE',
       'TBL_SERVICIOS',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'SER_INDICE = ' || :new.SER_INDICE || ' --> ' || '<eol>',
       'SER_TIPO = ' || :new.SER_TIPO || ' --> ' || 
       'SER_DESC_BREVE = ' || :new.SER_DESC_BREVE || ' --> ' || 
       'SER_NOMBRE = ' || :new.SER_NOMBRE || ' --> ' || 
       'SER_IMPUESTOS = ' || :new.SER_IMPUESTOS || ' --> ' ||
       'SER_ESTADO = ' || :new.SER_ESTADO || ' --> ' || 
       'SER_CODIGO = ' || :new.SER_CODIGO || ' --> ' || 
       'SER_TIPO_CODIGO = ' || :new.SER_TIPO_CODIGO || ' --> ' || 
       'SER_VENTA_IVI = ' || :new.SER_VENTA_IVI || ' --> ' ||
       '<eol>',
       :new.NO_CIA);
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA)
    VALUES
      ('SAFE',
       'TBL_SERVICIOS',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'SER_INDICE = ' || :new.SER_INDICE || ' --> ' || '<eol>',
       'SER_TIPO = ' || :new.SER_TIPO || ' --> ' || 
       'SER_DESC_BREVE = ' || :new.SER_DESC_BREVE || ' --> ' || 
       'SER_NOMBRE = ' || :new.SER_NOMBRE || ' --> ' || 
       'SER_IMPUESTOS = ' || :new.SER_IMPUESTOS || ' --> ' ||
       'SER_ESTADO = ' || :new.SER_ESTADO || ' --> ' || 
       'SER_CODIGO = ' || :new.SER_CODIGO || ' --> ' || 
       'SER_TIPO_CODIGO = ' || :new.SER_TIPO_CODIGO || ' --> ' || 
       'SER_VENTA_IVI = ' || :new.SER_VENTA_IVI || ' --> ' ||
       '<eol>',
       :new.NO_CIA);
  END IF;
END;

/

ALTER TABLE TBL_BITACORA 
ADD (NOMBRE_TABLA VARCHAR2(50) );

ALTER TABLE TBL_BITACORA 
ADD (TIPO_TABLA VARCHAR2(30) );

COMMENT ON COLUMN TBL_BITACORA.NOMBRE_TABLA IS 'Nombre de la tabla';

COMMENT ON COLUMN TBL_BITACORA.TIPO_TABLA IS 'Tipo de tabla, MANTENIMIENTOS, PROCESOS, SEGURIDAD, OTROS';

/

create or replace NONEDITIONABLE TRIGGER TR_CLIENTES_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_CLIENTES
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_CLIENTES',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'CLI_LINEA = ' || :OLD.CLI_LINEA || ' --> ' || '<eol>',
       'CLI_TIPO_ID = ' || :OLD.CLI_TIPO_ID || ' --> ' || 
       'CLI_NOMBRE = ' || :OLD.CLI_NOMBRE || ' --> ' || 
       'CLI_TELEFONO = ' || :OLD.CLI_TELEFONO || ' --> ' || 
       'CLI_ESTADO = ' || :OLD.CLI_ESTADO || ' --> ' || 
       'CLI_IDENTIFICACION = ' || :OLD.CLI_IDENTIFICACION || ' --> ' || 
       'CLI_FAX = ' || :OLD.CLI_FAX || ' --> ' ||        
       'CLI_CONTACTO = ' || :OLD.CLI_CONTACTO || ' --> ' || 
       'CLI_CORREO = ' || :OLD.CLI_CORREO || ' --> ' || 
       'CLI_UBICACION = ' || :OLD.CLI_UBICACION || ' --> ' || 
       'CLI_DIAS = ' || :OLD.CLI_DIAS || ' --> ' || 
       'CLI_ID = ' || :OLD.CLI_ID || ' --> ' || 
       'CLI_TIPOCLIENTE = ' || :OLD.CLI_TIPOCLIENTE || ' --> ' || 
       'CLI_LC_MONEDA = ' || :OLD.CLI_LC_MONEDA || ' --> ' || 
       'CLI_LC_LIMITE = ' || :OLD.CLI_LC_LIMITE || ' --> ' || 
       'PAIS = ' || :OLD.PAIS || ' --> ' || 
       'PROVINCIA = ' || :OLD.PROVINCIA || ' --> ' || 
       'CANTON = ' || :OLD.CANTON || ' --> ' || 
       'DISTRITO = ' || :OLD.DISTRITO || ' --> ' || 
       'BARRIO = ' || :OLD.BARRIO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'CLIENTES',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_CLIENTES',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'CLI_LINEA = ' || :new.CLI_LINEA || ' --> ' || '<eol>',
       'CLI_TIPO_ID = ' || :new.CLI_TIPO_ID || ' --> ' || 
       'CLI_NOMBRE = ' || :new.CLI_NOMBRE || ' --> ' || 
       'CLI_TELEFONO = ' || :new.CLI_TELEFONO || ' --> ' || 
       'CLI_ESTADO = ' || :new.CLI_ESTADO || ' --> ' || 
       'CLI_IDENTIFICACION = ' || :new.CLI_IDENTIFICACION || ' --> ' || 
       'CLI_FAX = ' || :new.CLI_FAX || ' --> ' ||        
       'CLI_CONTACTO = ' || :new.CLI_CONTACTO || ' --> ' || 
       'CLI_CORREO = ' || :new.CLI_CORREO || ' --> ' || 
       'CLI_UBICACION = ' || :new.CLI_UBICACION || ' --> ' || 
       'CLI_DIAS = ' || :new.CLI_DIAS || ' --> ' || 
       'CLI_ID = ' || :new.CLI_ID || ' --> ' || 
       'CLI_TIPOCLIENTE = ' || :new.CLI_TIPOCLIENTE || ' --> ' || 
       'CLI_LC_MONEDA = ' || :new.CLI_LC_MONEDA || ' --> ' || 
       'CLI_LC_LIMITE = ' || :new.CLI_LC_LIMITE || ' --> ' || 
       'PAIS = ' || :new.PAIS || ' --> ' || 
       'PROVINCIA = ' || :new.PROVINCIA || ' --> ' || 
       'CANTON = ' || :new.CANTON || ' --> ' || 
       'DISTRITO = ' || :new.DISTRITO || ' --> ' || 
       'BARRIO = ' || :new.BARRIO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'CLIENTES',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_CLIENTES',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'CLI_LINEA = ' || :new.CLI_LINEA || ' --> ' || '<eol>',
       'CLI_TIPO_ID = ' || :new.CLI_TIPO_ID || ' --> ' || 
       'CLI_NOMBRE = ' || :new.CLI_NOMBRE || ' --> ' || 
       'CLI_TELEFONO = ' || :new.CLI_TELEFONO || ' --> ' || 
       'CLI_ESTADO = ' || :new.CLI_ESTADO || ' --> ' || 
       'CLI_IDENTIFICACION = ' || :new.CLI_IDENTIFICACION || ' --> ' || 
       'CLI_FAX = ' || :new.CLI_FAX || ' --> ' ||        
       'CLI_CONTACTO = ' || :new.CLI_CONTACTO || ' --> ' || 
       'CLI_CORREO = ' || :new.CLI_CORREO || ' --> ' || 
       'CLI_UBICACION = ' || :new.CLI_UBICACION || ' --> ' || 
       'CLI_DIAS = ' || :new.CLI_DIAS || ' --> ' || 
       'CLI_ID = ' || :new.CLI_ID || ' --> ' || 
       'CLI_TIPOCLIENTE = ' || :new.CLI_TIPOCLIENTE || ' --> ' || 
       'CLI_LC_MONEDA = ' || :new.CLI_LC_MONEDA || ' --> ' || 
       'CLI_LC_LIMITE = ' || :new.CLI_LC_LIMITE || ' --> ' || 
       'PAIS = ' || :new.PAIS || ' --> ' || 
       'PROVINCIA = ' || :new.PROVINCIA || ' --> ' || 
       'CANTON = ' || :new.CANTON || ' --> ' || 
       'DISTRITO = ' || :new.DISTRITO || ' --> ' || 
       'BARRIO = ' || :new.BARRIO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'CLIENTES',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_EMPRESA_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_EMPRESA
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_EMPRESA',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || '<eol>',
       'EMPR_TIPO_ID = ' || :OLD.EMPR_TIPO_ID || ' --> ' || 
       'EMPR_IDENTIFICACION = ' || :OLD.EMPR_IDENTIFICACION || ' --> ' || 
       'EMPR_NOMBRE = ' || :OLD.EMPR_NOMBRE || ' --> ' || 
       'EMPR_DIRECCION = ' || :OLD.EMPR_DIRECCION || ' --> ' || 
       'EMPR_TELEFONO = ' || :OLD.EMPR_TELEFONO || ' --> ' || 
       'EMPR_CORREO = ' || :OLD.EMPR_CORREO || ' --> ' || 
       'IND_FACTURASABIERTAS = ' || :OLD.IND_FACTURASABIERTAS || ' --> ' || 
       'RUTAARCHIVOBACKUP = ' || :OLD.RUTAARCHIVOBACKUP || ' --> ' || 
       'BUSCATC = ' || :OLD.BUSCATC || ' --> ' || 
       'IND_REDONDEARPRECIOVENTA = ' || :OLD.IND_REDONDEARPRECIOVENTA || ' --> ' || 
       'IND_IMPRIMETIQUETALFACTURAR = ' || :OLD.IND_IMPRIMETIQUETALFACTURAR || ' --> ' || 
       'PAIS = ' || :OLD.PAIS || ' --> ' || 
       'PROVINCIA = ' || :OLD.PROVINCIA || ' --> ' || 
       'CANTON = ' || :OLD.CANTON || ' --> ' || 
       'DISTRITO = ' || :OLD.DISTRITO || ' --> ' || 
       'BARRIO = ' || :OLD.BARRIO || ' --> ' || 
       'IND_FACT_ELECT = ' || :OLD.IND_FACT_ELECT || ' --> ' || 
       'VERSION_FE = ' || :OLD.VERSION_FE || ' --> ' || 
       'APROBACION_DGT_FE = ' || :OLD.APROBACION_DGT_FE || ' --> ' || 
       'EMAIL_FE = ' || :OLD.EMAIL_FE || ' --> ' || 
       'FECHA_RESOL_FE = ' || :OLD.FECHA_RESOL_FE || ' --> ' || 
       'USUARIO_WS_FE = ' || :OLD.USUARIO_WS_FE || ' --> ' || 
       'CLAVE_WS_FE = ' || :OLD.CLAVE_WS_FE || ' --> ' || 
       'IND_USA_WS_FE = ' || :OLD.IND_USA_WS_FE || ' --> ' || 
       'SECUENCIAS_URL_WS_FE = ' || :OLD.SECUENCIAS_URL_WS_FE || ' --> ' || 
       'CODIGO_ACTIVIDAD = ' || :OLD.CODIGO_ACTIVIDAD || ' --> ' || 
       'LEYENDA_FISCAL = ' || :OLD.LEYENDA_FISCAL || ' --> ' || 
       'IND_IMPRIME_IMP_INCL = ' || :OLD.IND_IMPRIME_IMP_INCL || ' --> ' || 
       'LEYENDA_EXONERACION = ' || :OLD.LEYENDA_EXONERACION || ' --> ' || 
       'TIPO_NC_REC = ' || :OLD.TIPO_NC_REC || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'DATOS EMPRESA',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_EMPRESA',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || '<eol>',
       'EMPR_TIPO_ID = ' || :new.EMPR_TIPO_ID || ' --> ' || 
       'EMPR_IDENTIFICACION = ' || :new.EMPR_IDENTIFICACION || ' --> ' || 
       'EMPR_NOMBRE = ' || :new.EMPR_NOMBRE || ' --> ' || 
       'EMPR_DIRECCION = ' || :new.EMPR_DIRECCION || ' --> ' || 
       'EMPR_TELEFONO = ' || :new.EMPR_TELEFONO || ' --> ' || 
       'EMPR_CORREO = ' || :new.EMPR_CORREO || ' --> ' || 
       'IND_FACTURASABIERTAS = ' || :new.IND_FACTURASABIERTAS || ' --> ' ||        
       'RUTAARCHIVOBACKUP = ' || :new.RUTAARCHIVOBACKUP || ' --> ' || 
       'BUSCATC = ' || :new.BUSCATC || ' --> ' || 
       'IND_REDONDEARPRECIOVENTA = ' || :new.IND_REDONDEARPRECIOVENTA || ' --> ' || 
       'IND_IMPRIMETIQUETALFACTURAR = ' || :new.IND_IMPRIMETIQUETALFACTURAR || ' --> ' || 
       'PAIS = ' || :new.PAIS || ' --> ' || 
       'PROVINCIA = ' || :new.PROVINCIA || ' --> ' || 
       'CANTON = ' || :new.CANTON || ' --> ' || 
       'DISTRITO = ' || :new.DISTRITO || ' --> ' || 
       'PAIS = ' || :new.PAIS || ' --> ' || 
       'BARRIO = ' || :new.BARRIO || ' --> ' || 
       'IND_FACT_ELECT = ' || :new.IND_FACT_ELECT || ' --> ' || 
       'VERSION_FE = ' || :new.VERSION_FE || ' --> ' || 
       'APROBACION_DGT_FE = ' || :new.APROBACION_DGT_FE || ' --> ' || 
       'EMAIL_FE = ' || :new.EMAIL_FE || ' --> ' || 
       'FECHA_RESOL_FE = ' || :new.FECHA_RESOL_FE || ' --> ' || 
       'USUARIO_WS_FE = ' || :new.USUARIO_WS_FE || ' --> ' || 
       'CLAVE_WS_FE = ' || :new.CLAVE_WS_FE || ' --> ' || 
       'IND_USA_WS_FE = ' || :new.IND_USA_WS_FE || ' --> ' || 
       'SECUENCIAS_URL_WS_FE = ' || :new.SECUENCIAS_URL_WS_FE || ' --> ' || 
       'CODIGO_ACTIVIDAD = ' || :new.CODIGO_ACTIVIDAD || ' --> ' || 
       'LEYENDA_FISCAL = ' || :new.LEYENDA_FISCAL || ' --> ' || 
       'IND_IMPRIME_IMP_INCL = ' || :new.IND_IMPRIME_IMP_INCL || ' --> ' || 
       'LEYENDA_EXONERACION = ' || :new.LEYENDA_EXONERACION || ' --> ' || 
       'TIPO_NC_REC = ' || :new.TIPO_NC_REC || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'DATOS EMPRESA',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_EMPRESA',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || '<eol>',
       'EMPR_TIPO_ID = ' || :new.EMPR_TIPO_ID || ' --> ' || 
       'EMPR_IDENTIFICACION = ' || :new.EMPR_IDENTIFICACION || ' --> ' || 
       'EMPR_NOMBRE = ' || :new.EMPR_NOMBRE || ' --> ' || 
       'EMPR_DIRECCION = ' || :new.EMPR_DIRECCION || ' --> ' || 
       'EMPR_TELEFONO = ' || :new.EMPR_TELEFONO || ' --> ' || 
       'EMPR_CORREO = ' || :new.EMPR_CORREO || ' --> ' || 
       'IND_FACTURASABIERTAS = ' || :new.IND_FACTURASABIERTAS || ' --> ' ||        
       'RUTAARCHIVOBACKUP = ' || :new.RUTAARCHIVOBACKUP || ' --> ' || 
       'BUSCATC = ' || :new.BUSCATC || ' --> ' || 
       'IND_REDONDEARPRECIOVENTA = ' || :new.IND_REDONDEARPRECIOVENTA || ' --> ' || 
       'IND_IMPRIMETIQUETALFACTURAR = ' || :new.IND_IMPRIMETIQUETALFACTURAR || ' --> ' || 
       'PAIS = ' || :new.PAIS || ' --> ' || 
       'PROVINCIA = ' || :new.PROVINCIA || ' --> ' || 
       'CANTON = ' || :new.CANTON || ' --> ' || 
       'DISTRITO = ' || :new.DISTRITO || ' --> ' || 
       'PAIS = ' || :new.PAIS || ' --> ' || 
       'BARRIO = ' || :new.BARRIO || ' --> ' || 
       'IND_FACT_ELECT = ' || :new.IND_FACT_ELECT || ' --> ' || 
       'VERSION_FE = ' || :new.VERSION_FE || ' --> ' || 
       'APROBACION_DGT_FE = ' || :new.APROBACION_DGT_FE || ' --> ' || 
       'EMAIL_FE = ' || :new.EMAIL_FE || ' --> ' || 
       'FECHA_RESOL_FE = ' || :new.FECHA_RESOL_FE || ' --> ' || 
       'USUARIO_WS_FE = ' || :new.USUARIO_WS_FE || ' --> ' || 
       'CLAVE_WS_FE = ' || :new.CLAVE_WS_FE || ' --> ' || 
       'IND_USA_WS_FE = ' || :new.IND_USA_WS_FE || ' --> ' || 
       'SECUENCIAS_URL_WS_FE = ' || :new.SECUENCIAS_URL_WS_FE || ' --> ' || 
       'CODIGO_ACTIVIDAD = ' || :new.CODIGO_ACTIVIDAD || ' --> ' || 
       'LEYENDA_FISCAL = ' || :new.LEYENDA_FISCAL || ' --> ' || 
       'IND_IMPRIME_IMP_INCL = ' || :new.IND_IMPRIME_IMP_INCL || ' --> ' || 
       'LEYENDA_EXONERACION = ' || :new.LEYENDA_EXONERACION || ' --> ' || 
       'TIPO_NC_REC = ' || :new.TIPO_NC_REC || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'DATOS EMPRESA',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_GASTOS_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_GASTOS
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_GASTOS',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'GAS_INDICE = ' || :OLD.GAS_INDICE || ' --> ' || '<eol>',
       'GAS_CODIGO = ' || :OLD.GAS_CODIGO || ' --> ' || 
       'GAS_NOMBRE = ' || :OLD.GAS_NOMBRE || ' --> ' || 
       'GAS_FLUJO_CAJA = ' || :OLD.GAS_FLUJO_CAJA || ' --> ' || 
       'GAS_ESTADO = ' || :OLD.GAS_ESTADO || ' --> ' || 
       'GAS_TIPO = ' || :OLD.GAS_TIPO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'GASTOS',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_GASTOS',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'GAS_INDICE = ' || :new.GAS_INDICE || ' --> ' || '<eol>',
       'GAS_CODIGO = ' || :new.GAS_CODIGO || ' --> ' || 
       'GAS_NOMBRE = ' || :new.GAS_NOMBRE || ' --> ' || 
       'GAS_FLUJO_CAJA = ' || :new.GAS_FLUJO_CAJA || ' --> ' || 
       'GAS_ESTADO = ' || :new.GAS_ESTADO || ' --> ' || 
       'GAS_TIPO = ' || :new.GAS_TIPO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'GASTOS',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_GASTOS',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'GAS_INDICE = ' || :new.GAS_INDICE || ' --> ' || '<eol>',
       'GAS_CODIGO = ' || :new.GAS_CODIGO || ' --> ' || 
       'GAS_NOMBRE = ' || :new.GAS_NOMBRE || ' --> ' || 
       'GAS_FLUJO_CAJA = ' || :new.GAS_FLUJO_CAJA || ' --> ' || 
       'GAS_ESTADO = ' || :new.GAS_ESTADO || ' --> ' || 
       'GAS_TIPO = ' || :new.GAS_TIPO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'GASTOS',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_IMPUESTOS_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_IMPUESTOS
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_IMPUESTOS',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'CLAVE = ' || :OLD.CLAVE || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :OLD.DESCRIPCION || ' --> ' || 
       'PORCENTAJE = ' || :OLD.PORCENTAJE || ' --> ' || 
       'INCLUIDO = ' || :OLD.INCLUIDO || ' --> ' || 
       'TSTAMP = ' || :OLD.TSTAMP || ' --> ' || 
       'EQUIV_IMP_FE = ' || :OLD.EQUIV_IMP_FE || ' --> ' || 
       'EQUIV_IMP_TAR_FE = ' || :OLD.EQUIV_IMP_TAR_FE || ' --> ' ||        
       'IND_PROPORCIONALIDAD = ' || :OLD.IND_PROPORCIONALIDAD || ' --> ' || 
       'PORC_IMP_GEN_FE = ' || :OLD.PORC_IMP_GEN_FE || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'IMPUESTOS',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_IMPUESTOS',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'CLAVE = ' || :new.CLAVE || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :new.DESCRIPCION || ' --> ' || 
       'PORCENTAJE = ' || :new.PORCENTAJE || ' --> ' || 
       'INCLUIDO = ' || :new.INCLUIDO || ' --> ' || 
       'TSTAMP = ' || :new.TSTAMP || ' --> ' || 
       'EQUIV_IMP_FE = ' || :new.EQUIV_IMP_FE || ' --> ' || 
       'EQUIV_IMP_TAR_FE = ' || :new.EQUIV_IMP_TAR_FE || ' --> ' ||       
       'IND_PROPORCIONALIDAD = ' || :new.IND_PROPORCIONALIDAD || ' --> ' || 
       'PORC_IMP_GEN_FE = ' || :new.PORC_IMP_GEN_FE || ' --> ' ||
       '<eol>',
       :new.NO_CIA,
       'IMPUESTOS',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_IMPUESTOS',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'CLAVE = ' || :new.CLAVE || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :new.DESCRIPCION || ' --> ' || 
       'PORCENTAJE = ' || :new.PORCENTAJE || ' --> ' || 
       'INCLUIDO = ' || :new.INCLUIDO || ' --> ' || 
       'TSTAMP = ' || :new.TSTAMP || ' --> ' || 
       'EQUIV_IMP_FE = ' || :new.EQUIV_IMP_FE || ' --> ' || 
       'EQUIV_IMP_TAR_FE = ' || :new.EQUIV_IMP_TAR_FE || ' --> ' ||        
       'IND_PROPORCIONALIDAD = ' || :new.IND_PROPORCIONALIDAD || ' --> ' || 
       'PORC_IMP_GEN_FE = ' || :new.PORC_IMP_GEN_FE || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'IMPUESTOS',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_SERVICIOS_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_SERVICIOS
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_SERVICIOS',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :old.NO_CIA || ' --> ' || 'SER_INDICE = ' || :old.SER_INDICE || ' --> ' || '<eol>',
       'SER_TIPO = ' || :old.SER_TIPO || ' --> ' || 
       'SER_DESC_BREVE = ' || :old.SER_DESC_BREVE || ' --> ' || 
       'SER_NOMBRE = ' || :old.SER_NOMBRE || ' --> ' || 
       'SER_IMPUESTOS = ' || :old.SER_IMPUESTOS || ' --> ' ||
       'SER_ESTADO = ' || :old.SER_ESTADO || ' --> ' || 
       'SER_CODIGO = ' || :old.SER_CODIGO || ' --> ' || 
       'SER_TIPO_CODIGO = ' || :old.SER_TIPO_CODIGO || ' --> ' || 
       'SER_VENTA_IVI = ' || :old.SER_VENTA_IVI || ' --> ' ||
       '<eol>',
       :old.NO_CIA,
       'SERVICIOS',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_SERVICIOS',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'SER_INDICE = ' || :new.SER_INDICE || ' --> ' || '<eol>',
       'SER_TIPO = ' || :new.SER_TIPO || ' --> ' || 
       'SER_DESC_BREVE = ' || :new.SER_DESC_BREVE || ' --> ' || 
       'SER_NOMBRE = ' || :new.SER_NOMBRE || ' --> ' || 
       'SER_IMPUESTOS = ' || :new.SER_IMPUESTOS || ' --> ' ||
       'SER_ESTADO = ' || :new.SER_ESTADO || ' --> ' || 
       'SER_CODIGO = ' || :new.SER_CODIGO || ' --> ' || 
       'SER_TIPO_CODIGO = ' || :new.SER_TIPO_CODIGO || ' --> ' || 
       'SER_VENTA_IVI = ' || :new.SER_VENTA_IVI || ' --> ' ||
       '<eol>',
       :new.NO_CIA,
       'SERVICIOS',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_SERVICIOS',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'SER_INDICE = ' || :new.SER_INDICE || ' --> ' || '<eol>',
       'SER_TIPO = ' || :new.SER_TIPO || ' --> ' || 
       'SER_DESC_BREVE = ' || :new.SER_DESC_BREVE || ' --> ' || 
       'SER_NOMBRE = ' || :new.SER_NOMBRE || ' --> ' || 
       'SER_IMPUESTOS = ' || :new.SER_IMPUESTOS || ' --> ' ||
       'SER_ESTADO = ' || :new.SER_ESTADO || ' --> ' || 
       'SER_CODIGO = ' || :new.SER_CODIGO || ' --> ' || 
       'SER_TIPO_CODIGO = ' || :new.SER_TIPO_CODIGO || ' --> ' || 
       'SER_VENTA_IVI = ' || :new.SER_VENTA_IVI || ' --> ' ||
       '<eol>',
       :new.NO_CIA,
       'SERVICIOS',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_PROVEEDOR_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_PROVEEDOR
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_PROVEEDOR',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'PROV_LINEA = ' || :OLD.PROV_LINEA || ' --> ' || '<eol>',
       'PROV_ID = ' || :OLD.PROV_ID || ' --> ' || 
       'PROV_TIPO_ID = ' || :OLD.PROV_TIPO_ID || ' --> ' || 
       'PROV_NOMBRE = ' || :OLD.PROV_NOMBRE || ' --> ' || 
       'PROV_TELEFONO = ' || :OLD.PROV_TELEFONO || ' --> ' || 
       'PROV_FAX = ' || :OLD.PROV_FAX || ' --> ' || 
       'PROV_CONTACTO = ' || :OLD.PROV_CONTACTO || ' --> ' ||        
       'PROV_TEL_CONTACTO = ' || :OLD.PROV_TEL_CONTACTO || ' --> ' || 
       'PROV_UBICACION = ' || :OLD.PROV_UBICACION || ' --> ' || 
       'PROV_DESCRIPCION = ' || :OLD.PROV_DESCRIPCION || ' --> ' || 
       'PROV_DIAS = ' || :OLD.PROV_DIAS || ' --> ' || 
       'PROV_CATEGORIA = ' || :OLD.PROV_CATEGORIA || ' --> ' || 
       'PROV_REFBANCARIA = ' || :OLD.PROV_REFBANCARIA || ' --> ' || 
       'PROV_ESTADO = ' || :OLD.PROV_ESTADO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'PROVEEDORES',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_PROVEEDOR',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'PROV_LINEA = ' || :new.PROV_LINEA || ' --> ' || '<eol>',
       'PROV_ID = ' || :new.PROV_ID || ' --> ' || 
       'PROV_TIPO_ID = ' || :new.PROV_TIPO_ID || ' --> ' || 
       'PROV_NOMBRE = ' || :new.PROV_NOMBRE || ' --> ' || 
       'PROV_TELEFONO = ' || :new.PROV_TELEFONO || ' --> ' || 
       'PROV_FAX = ' || :new.PROV_FAX || ' --> ' || 
       'PROV_CONTACTO = ' || :new.PROV_CONTACTO || ' --> ' ||        
       'PROV_TEL_CONTACTO = ' || :new.PROV_TEL_CONTACTO || ' --> ' || 
       'PROV_UBICACION = ' || :new.PROV_UBICACION || ' --> ' || 
       'PROV_DESCRIPCION = ' || :new.PROV_DESCRIPCION || ' --> ' || 
       'PROV_DIAS = ' || :new.PROV_DIAS || ' --> ' || 
       'PROV_CATEGORIA = ' || :new.PROV_CATEGORIA || ' --> ' || 
       'PROV_REFBANCARIA = ' || :new.PROV_REFBANCARIA || ' --> ' || 
       'PROV_ESTADO = ' || :new.PROV_ESTADO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'PROVEEDORES',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_PROVEEDOR',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'PROV_LINEA = ' || :new.PROV_LINEA || ' --> ' || '<eol>',
       'PROV_ID = ' || :new.PROV_ID || ' --> ' || 
       'PROV_TIPO_ID = ' || :new.PROV_TIPO_ID || ' --> ' || 
       'PROV_NOMBRE = ' || :new.PROV_NOMBRE || ' --> ' || 
       'PROV_TELEFONO = ' || :new.PROV_TELEFONO || ' --> ' || 
       'PROV_FAX = ' || :new.PROV_FAX || ' --> ' || 
       'PROV_CONTACTO = ' || :new.PROV_CONTACTO || ' --> ' ||        
       'PROV_TEL_CONTACTO = ' || :new.PROV_TEL_CONTACTO || ' --> ' || 
       'PROV_UBICACION = ' || :new.PROV_UBICACION || ' --> ' || 
       'PROV_DESCRIPCION = ' || :new.PROV_DESCRIPCION || ' --> ' || 
       'PROV_DIAS = ' || :new.PROV_DIAS || ' --> ' || 
       'PROV_CATEGORIA = ' || :new.PROV_CATEGORIA || ' --> ' || 
       'PROV_REFBANCARIA = ' || :new.PROV_REFBANCARIA || ' --> ' || 
       'PROV_ESTADO = ' || :new.PROV_ESTADO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'PROVEEDORES',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_SERVICIO_IMPUESTOS_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_SERVICIO_IMPUESTOS
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_SERVICIO_IMPUESTOS',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'CODIGO_SERVICIO = ' || :OLD.CODIGO_SERVICIO || ' --> ' || '<eol>',
       'CLAVE = ' || :OLD.CLAVE || ' --> ' || 
       'AFECTA_VENTA = ' || :OLD.AFECTA_VENTA || ' --> ' || 
       'TSTAMP = ' || :OLD.TSTAMP || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'IMPUESTOS EN SERVICIOS',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_SERVICIO_IMPUESTOS',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'CODIGO_SERVICIO = ' || :new.CODIGO_SERVICIO || ' --> ' || '<eol>',
       'CLAVE = ' || :new.CLAVE || ' --> ' || 
       'AFECTA_VENTA = ' || :new.AFECTA_VENTA || ' --> ' || 
       'TSTAMP = ' || :new.TSTAMP || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'IMPUESTOS EN SERVICIOS',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_SERVICIO_IMPUESTOS',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'CODIGO_SERVICIO = ' || :new.CODIGO_SERVICIO || ' --> ' || '<eol>',
       'CLAVE = ' || :new.CLAVE || ' --> ' || 
       'AFECTA_VENTA = ' || :new.AFECTA_VENTA || ' --> ' || 
       'TSTAMP = ' || :new.TSTAMP || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'IMPUESTOS EN SERVICIOS',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_TIPOS_DOCUMENTO_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_TIPOS_DOCUMENTO
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_TIPOS_DOCUMENTO',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'TIPO_DOC = ' || :OLD.TIPO_DOC || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :OLD.DESCRIPCION || ' --> ' || 
       'TIPO_MOV = ' || :OLD.TIPO_MOV || ' --> ' || 
       'AFECTA_CXC = ' || :OLD.AFECTA_CXC || ' --> ' || 
       'TSTAMP = ' || :OLD.TSTAMP || ' --> ' || 
       'IND_PROFORMA = ' || :OLD.IND_PROFORMA || ' --> ' || 
       'TIPO_DOC_FE = ' || :OLD.TIPO_DOC_FE || ' --> ' ||        
       'TIPO_IMP_FE = ' || :OLD.TIPO_IMP_FE || ' --> ' || 
       'CANTIDAD_IMPRESION = ' || :OLD.CANTIDAD_IMPRESION || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'TIPOS DE DOCUMENTO',
       'MANTENIMIENTOS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_TIPOS_DOCUMENTO',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'TIPO_DOC = ' || :new.TIPO_DOC || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :new.DESCRIPCION || ' --> ' || 
       'TIPO_MOV = ' || :new.TIPO_MOV || ' --> ' || 
       'AFECTA_CXC = ' || :new.AFECTA_CXC || ' --> ' || 
       'TSTAMP = ' || :new.TSTAMP || ' --> ' || 
       'IND_PROFORMA = ' || :new.IND_PROFORMA || ' --> ' || 
       'TIPO_DOC_FE = ' || :new.TIPO_DOC_FE || ' --> ' ||        
       'TIPO_IMP_FE = ' || :new.TIPO_IMP_FE || ' --> ' || 
       'CANTIDAD_IMPRESION = ' || :new.CANTIDAD_IMPRESION || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'TIPOS DE DOCUMENTO',
       'MANTENIMIENTOS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_TIPOS_DOCUMENTO',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'TIPO_DOC = ' || :new.TIPO_DOC || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :new.DESCRIPCION || ' --> ' || 
       'TIPO_MOV = ' || :new.TIPO_MOV || ' --> ' || 
       'AFECTA_CXC = ' || :new.AFECTA_CXC || ' --> ' || 
       'TSTAMP = ' || :new.TSTAMP || ' --> ' || 
       'IND_PROFORMA = ' || :new.IND_PROFORMA || ' --> ' || 
       'TIPO_DOC_FE = ' || :new.TIPO_DOC_FE || ' --> ' ||        
       'TIPO_IMP_FE = ' || :new.TIPO_IMP_FE || ' --> ' || 
       'CANTIDAD_IMPRESION = ' || :new.CANTIDAD_IMPRESION || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'TIPOS DE DOCUMENTO',
       'MANTENIMIENTOS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_PERMISOS_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_PERMISOS
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_PERMISOS',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'PER_USUARIO = ' || :OLD.PER_USUARIO || ' --> ' || '<eol>',
       'PER_ID_PANTALLA = ' || :OLD.PER_ID_PANTALLA || ' --> ' || 
       'PER_ACCESO = ' || :OLD.PER_ACCESO || ' --> ' || 
       'PER_ESTADO = ' || :OLD.PER_ESTADO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'PERMISOS',
       'SEGURIDAD');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_PERMISOS',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'PER_USUARIO = ' || :new.PER_USUARIO || ' --> ' || '<eol>',
       'PER_ID_PANTALLA = ' || :new.PER_ID_PANTALLA || ' --> ' || 
       'PER_ACCESO = ' || :new.PER_ACCESO || ' --> ' || 
       'PER_ESTADO = ' || :new.PER_ESTADO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'PERMISOS',
       'SEGURIDAD');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_PERMISOS',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'PER_USUARIO = ' || :new.PER_USUARIO || ' --> ' || '<eol>',
       'PER_ID_PANTALLA = ' || :new.PER_ID_PANTALLA || ' --> ' || 
       'PER_ACCESO = ' || :new.PER_ACCESO || ' --> ' || 
       'PER_ESTADO = ' || :new.PER_ESTADO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'PERMISOS',
       'SEGURIDAD');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_TIPOS_ID_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBL_TIPOS_ID
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_TIPOS_ID',
       'DELETE',
       user,
       sysdate,
       'CODIGO = ' || :OLD.CODIGO || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :OLD.DESCRIPCION || ' --> ' || 
       'ETIQUETA = ' || :OLD.ETIQUETA || ' --> ' || 
       'FORMATO = ' || :OLD.FORMATO || ' --> ' || 
       'DIGITO_VERIF = ' || :OLD.DIGITO_VERIF || ' --> ' || 
       'PREFIJO_ID_INS = ' || :OLD.PREFIJO_ID_INS || ' --> ' || 
       'IND_VALIDA_FORMATO = ' || :OLD.IND_VALIDA_FORMATO || ' --> ' ||        
       'IND_DESGLOSA_NOMBRE = ' || :OLD.IND_DESGLOSA_NOMBRE || ' --> ' || 
       'EQUIV_ID_FE = ' || :OLD.EQUIV_ID_FE || ' --> ' || 
       '<eol>',
       NULL,
       'TIPOS DE ID',
       'OTROS');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_TIPOS_ID',
       'INSERT',
       user,
       sysdate,
       'CODIGO = ' || :new.CODIGO || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :new.DESCRIPCION || ' --> ' || 
       'ETIQUETA = ' || :new.ETIQUETA || ' --> ' || 
       'FORMATO = ' || :new.FORMATO || ' --> ' || 
       'DIGITO_VERIF = ' || :new.DIGITO_VERIF || ' --> ' || 
       'PREFIJO_ID_INS = ' || :new.PREFIJO_ID_INS || ' --> ' || 
       'IND_VALIDA_FORMATO = ' || :new.IND_VALIDA_FORMATO || ' --> ' ||        
       'IND_DESGLOSA_NOMBRE = ' || :new.IND_DESGLOSA_NOMBRE || ' --> ' || 
       'EQUIV_ID_FE = ' || :new.EQUIV_ID_FE || ' --> ' || 
       '<eol>',
       NULL,
       'TIPOS DE ID',
       'OTROS');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBL_TIPOS_ID',
       'UPDATE',
       user,
       sysdate,
       'CODIGO = ' || :new.CODIGO || ' --> ' || '<eol>',
       'DESCRIPCION = ' || :new.DESCRIPCION || ' --> ' || 
       'ETIQUETA = ' || :new.ETIQUETA || ' --> ' || 
       'FORMATO = ' || :new.FORMATO || ' --> ' || 
       'DIGITO_VERIF = ' || :new.DIGITO_VERIF || ' --> ' || 
       'PREFIJO_ID_INS = ' || :new.PREFIJO_ID_INS || ' --> ' || 
       'IND_VALIDA_FORMATO = ' || :new.IND_VALIDA_FORMATO || ' --> ' ||        
       'IND_DESGLOSA_NOMBRE = ' || :new.IND_DESGLOSA_NOMBRE || ' --> ' || 
       'EQUIV_ID_FE = ' || :new.EQUIV_ID_FE || ' --> ' || 
       '<eol>',
       NULL,
       'TIPOS DE ID',
       'OTROS');
  END IF;
END;

/

create or replace NONEDITIONABLE TRIGGER TR_USUARIO_BIT
  BEFORE INSERT OR DELETE OR UPDATE ON TBUSUARIO
  FOR EACH ROW

BEGIN
  IF deleting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBUSUARIO',
       'DELETE',
       user,
       sysdate,
       'NO_CIA = ' || :OLD.NO_CIA || ' --> ' || 'USUARIO = ' || :OLD.USUARIO || ' --> ' || '<eol>',
       'CONTRASENNA = ' || :OLD.CONTRASENNA || ' --> ' || 
       'FECHA = ' || :OLD.FECHA || ' --> ' || 
       'ROL = ' || :OLD.ROL || ' --> ' || 
       'ESTADO = ' || :OLD.ESTADO || ' --> ' || 
       'NOMBRE = ' || :OLD.NOMBRE || ' --> ' || 
       'APELLIDO1 = ' || :OLD.APELLIDO1 || ' --> ' ||        
       'APELLIDO2 = ' || :OLD.APELLIDO2 || ' --> ' || 
       'CEDULA = ' || :OLD.CEDULA || ' --> ' || 
       'EMAIL = ' || :OLD.EMAIL || ' --> ' || 
       'IND_REQ_CAMBIO = ' || :OLD.IND_REQ_CAMBIO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'USUARIOS',
       'SEGURIDAD');
  ELSIF inserting THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBUSUARIO',
       'INSERT',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'USUARIO = ' || :new.USUARIO || ' --> ' || '<eol>',
       'CONTRASENNA = ' || :new.CONTRASENNA || ' --> ' || 
       'FECHA = ' || :new.FECHA || ' --> ' || 
       'ROL = ' || :new.ROL || ' --> ' || 
       'ESTADO = ' || :new.ESTADO || ' --> ' || 
       'NOMBRE = ' || :new.NOMBRE || ' --> ' || 
       'APELLIDO1 = ' || :new.APELLIDO1 || ' --> ' ||        
       'APELLIDO2 = ' || :new.APELLIDO2 || ' --> ' || 
       'CEDULA = ' || :new.CEDULA || ' --> ' || 
       'EMAIL = ' || :new.EMAIL || ' --> ' || 
       'IND_REQ_CAMBIO = ' || :new.IND_REQ_CAMBIO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'USUARIOS',
       'SEGURIDAD');
  ELSIF updating THEN
    INSERT INTO TBL_BITACORA
      (USUARIO_DUENO,
       TABLA,
       MOVIMIENTO,
       USUARIO,
       FECHA,
       LLAVE,
       VALORES,
       NO_CIA,
       NOMBRE_TABLA,
       TIPO_TABLA)
    VALUES
      ('SAFE',
       'TBUSUARIO',
       'UPDATE',
       user,
       sysdate,
       'NO_CIA = ' || :new.NO_CIA || ' --> ' || 'USUARIO = ' || :new.USUARIO || ' --> ' || '<eol>',
       'CONTRASENNA = ' || :new.CONTRASENNA || ' --> ' || 
       'FECHA = ' || :new.FECHA || ' --> ' || 
       'ROL = ' || :new.ROL || ' --> ' || 
       'ESTADO = ' || :new.ESTADO || ' --> ' || 
       'NOMBRE = ' || :new.NOMBRE || ' --> ' || 
       'APELLIDO1 = ' || :new.APELLIDO1 || ' --> ' ||        
       'APELLIDO2 = ' || :new.APELLIDO2 || ' --> ' || 
       'CEDULA = ' || :new.CEDULA || ' --> ' || 
       'EMAIL = ' || :new.EMAIL || ' --> ' || 
       'IND_REQ_CAMBIO = ' || :new.IND_REQ_CAMBIO || ' --> ' || 
       '<eol>',
       :new.NO_CIA,
       'USUARIOS',
       'SEGURIDAD');
  END IF;
END;

/

